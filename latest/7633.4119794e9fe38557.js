(self.webpackChunkreport_tester=self.webpackChunkreport_tester||[]).push([[7633],{47633:(m,p,u)=>{u.r(p),u.d(p,{WebSocketSubject:()=>d,webSocket:()=>_});var b=u(86104),g=u(34805),y=u(74630),x=u(79149),S=u(22555);const W={url:"",deserializer:f=>JSON.parse(f.data),serializer:f=>JSON.stringify(f)};class d extends b.u{constructor(t,n){if(super(),this._socket=null,t instanceof y.y)this.destination=n,this.source=t;else{const s=this._config=Object.assign({},W);if(this._output=new b.x,"string"==typeof t)s.url=t;else for(const r in t)t.hasOwnProperty(r)&&(s[r]=t[r]);if(!s.WebSocketCtor&&WebSocket)s.WebSocketCtor=WebSocket;else if(!s.WebSocketCtor)throw new Error("no WebSocket constructor can be found");this.destination=new S.t}}lift(t){const n=new d(this._config,this.destination);return n.operator=t,n.source=this,n}_resetState(){this._socket=null,this.source||(this.destination=new S.t),this._output=new b.x}multiplex(t,n,s){const r=this;return new y.y(o=>{try{r.next(t())}catch(c){o.error(c)}const e=r.subscribe({next:c=>{try{s(c)&&o.next(c)}catch(i){o.error(i)}},error:c=>o.error(c),complete:()=>o.complete()});return()=>{try{r.next(n())}catch(c){o.error(c)}e.unsubscribe()}})}_connectSocket(){const{WebSocketCtor:t,protocol:n,url:s,binaryType:r}=this._config,o=this._output;let e=null;try{e=n?new t(s,n):new t(s),this._socket=e,r&&(this._socket.binaryType=r)}catch(i){return void o.error(i)}const c=new x.w0(()=>{this._socket=null,e&&1===e.readyState&&e.close()});e.onopen=i=>{const{_socket:h}=this;if(!h)return e.close(),void this._resetState();const{openObserver:w}=this._config;w&&w.next(i);const k=this.destination;this.destination=g.Lv.create(a=>{if(1===e.readyState)try{const{serializer:l}=this._config;e.send(l(a))}catch(l){this.destination.error(l)}},a=>{const{closingObserver:l}=this._config;l&&l.next(void 0),a&&a.code?e.close(a.code,a.reason):o.error(new TypeError("WebSocketSubject.error must be called with an object with an error code, and an optional reason: { code: number, reason: string }")),this._resetState()},()=>{const{closingObserver:a}=this._config;a&&a.next(void 0),e.close(),this._resetState()}),k&&k instanceof S.t&&c.add(k.subscribe(this.destination))},e.onerror=i=>{this._resetState(),o.error(i)},e.onclose=i=>{e===this._socket&&this._resetState();const{closeObserver:h}=this._config;h&&h.next(i),i.wasClean?o.complete():o.error(i)},e.onmessage=i=>{try{const{deserializer:h}=this._config;o.next(h(i))}catch(h){o.error(h)}}}_subscribe(t){const{source:n}=this;return n?n.subscribe(t):(this._socket||this._connectSocket(),this._output.subscribe(t),t.add(()=>{const{_socket:s}=this;0===this._output.observers.length&&(s&&(1===s.readyState||0===s.readyState)&&s.close(),this._resetState())}),t)}unsubscribe(){const{_socket:t}=this;t&&(1===t.readyState||0===t.readyState)&&t.close(),this._resetState(),super.unsubscribe()}}function _(f){return new d(f)}}}]);